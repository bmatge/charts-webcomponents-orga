<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gouv-orgchart — Démo</title>
  <style>
    @font-face {
      font-family: 'Marianne';
      src: url('https://www.systeme-de-design.gouv.fr/uploads/Marianne_Regular_64a93ac463.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Marianne';
      src: url('https://www.systeme-de-design.gouv.fr/uploads/Marianne_Bold_9263ad6360.woff2') format('woff2');
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Marianne', arial, sans-serif;
      background: #f6f6f6;
      color: #161616;
      padding: 2rem;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: #000091;
    }

    .subtitle {
      color: #666;
      margin-bottom: 2rem;
    }

    .demo-section {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .demo-section h2 {
      font-size: 1.25rem;
      margin-bottom: 0.25rem;
      color: #000091;
    }

    .demo-section p {
      color: #666;
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    .demo-controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .demo-controls label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }

    .demo-controls select, .demo-controls input {
      padding: 0.375rem 0.5rem;
      border: 1px solid #ddd;
      border-radius: 0.25rem;
      font-family: inherit;
      font-size: 0.875rem;
    }

    .event-log {
      background: #1e1e1e;
      color: #d4d4d4;
      font-family: monospace;
      font-size: 0.75rem;
      padding: 0.75rem;
      border-radius: 0.25rem;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 1rem;
    }

    .event-log div {
      padding: 0.125rem 0;
    }

    .event-log .event-type {
      color: #569cd6;
    }

    .event-log .event-data {
      color: #9cdcfe;
    }
  </style>
</head>
<body>
  <h1>gouv-orgchart</h1>
  <p class="subtitle">Web Component d'organigramme hiérarchique — Conformité DSFR</p>

  <!-- Demo 1: Simple -->
  <section class="demo-section">
    <h2>1. Organigramme simple</h2>
    <p>5 noeuds, mode carte, tous les niveaux dépliés.</p>
    <gouv-orgchart
      id="demo-simple"
      title="Direction générale"
      node-style="card"
      expand-level="0"
    ></gouv-orgchart>
  </section>

  <!-- Demo 2: Ministere -->
  <section class="demo-section">
    <h2>2. Organigramme ministériel</h2>
    <p>~20 noeuds avec assistants, transversaux, postes vacants. Zoom et recherche activés.</p>
    <div class="demo-controls">
      <label>
        Style :
        <select id="style-select">
          <option value="card" selected>Carte</option>
          <option value="compact">Compact</option>
          <option value="detailed">Détaillé</option>
        </select>
      </label>
      <label>
        Orientation :
        <select id="orientation-select">
          <option value="top-to-bottom" selected>Haut → Bas</option>
          <option value="left-to-right">Gauche → Droite</option>
        </select>
      </label>
      <label>
        Niveaux dépliés :
        <input type="number" id="expand-level" value="2" min="0" max="10" style="width: 4rem" />
      </label>
    </div>
    <gouv-orgchart
      id="demo-ministere"
      title="Ministère de l'Exemple"
      node-style="card"
      expand-level="2"
      searchable
      collapsible
      zoom
      highlight-path
    ></gouv-orgchart>
    <div class="event-log" id="event-log">
      <div style="color: #666;">— Journal des événements —</div>
    </div>
  </section>

  <!-- Demo 3: Roles -->
  <section class="demo-section">
    <h2>3. Rôles spéciaux</h2>
    <p>Démonstration des types de rôles : assistant (à gauche), transversal (à droite), vacant, intérim.</p>
    <gouv-orgchart
      id="demo-roles"
      title="Direction avec rôles spéciaux"
      node-style="card"
      expand-level="0"
      collapsible
    ></gouv-orgchart>
  </section>

  <!-- Demo 4: Compact -->
  <section class="demo-section">
    <h2>4. Mode compact</h2>
    <p>Mode compact pour les grands organigrammes : noms et fonctions uniquement.</p>
    <gouv-orgchart
      id="demo-compact"
      title="Vue compacte"
      node-style="compact"
      compact
      expand-level="0"
    ></gouv-orgchart>
  </section>

  <script type="module">
    import '../src/gouv-orgchart.ts';

    // Load data
    async function loadData(url) {
      const resp = await fetch(url);
      return resp.json();
    }

    async function init() {
      const [simpleData, ministereData, rolesData] = await Promise.all([
        loadData('./data-simple.json'),
        loadData('./data-ministere.json'),
        loadData('./data-roles.json'),
      ]);

      // Demo 1
      document.getElementById('demo-simple').data = simpleData;

      // Demo 2
      const demoMinistere = document.getElementById('demo-ministere');
      demoMinistere.data = ministereData;

      // Demo 3
      document.getElementById('demo-roles').data = rolesData;

      // Demo 4 (reuse ministere data)
      document.getElementById('demo-compact').data = ministereData;

      // Controls for demo 2
      document.getElementById('style-select').addEventListener('change', (e) => {
        demoMinistere.setAttribute('node-style', e.target.value);
      });

      document.getElementById('orientation-select').addEventListener('change', (e) => {
        demoMinistere.setAttribute('orientation', e.target.value);
      });

      document.getElementById('expand-level').addEventListener('change', (e) => {
        demoMinistere.expandToLevel(Number(e.target.value));
      });

      // Event log
      const log = document.getElementById('event-log');
      function logEvent(type, detail) {
        const div = document.createElement('div');
        const summary = detail.node
          ? `${detail.node.data?.prenom || ''} ${detail.node.data?.nom || ''} (id: ${detail.node.id})`
          : JSON.stringify(detail);
        div.innerHTML = `<span class="event-type">${type}</span> <span class="event-data">${summary}</span>`;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
      }

      demoMinistere.addEventListener('node-click', (e) => logEvent('node-click', e.detail));
      demoMinistere.addEventListener('node-expand', (e) =>
        logEvent('node-expand', { ...e.detail, expanded: e.detail.expanded })
      );
      demoMinistere.addEventListener('search-result', (e) =>
        logEvent('search-result', { query: e.detail.query, count: e.detail.results.length })
      );
      demoMinistere.addEventListener('data-error', (e) => logEvent('data-error', e.detail));
    }

    init();
  </script>
</body>
</html>
